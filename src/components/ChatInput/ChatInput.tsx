import './ChatInput.css';
import { useState, useRef } from 'react';

interface ChatInputProps {
  input: string;
  loading: boolean;
  onInputChange: (value: string) => void;
  onSendMessage: (message: string, file?: File | null) => void;
}

export const ChatInput = ({ input, loading, onInputChange, onSendMessage }: ChatInputProps) => {
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      if (input.trim() || selectedFile) {
        onSendMessage(input, selectedFile);
        setSelectedFile(null);
        if (fileInputRef.current) {
          fileInputRef.current.value = "";
        }
      }
    }
  };

  const handleSendClick = () => {
    if (input.trim() || selectedFile) {
      onSendMessage(input, selectedFile);
      setSelectedFile(null);
      if (fileInputRef.current) {
        fileInputRef.current.value = "";
      }
    }
  };

  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    if (event.target.files && event.target.files[0]) {
      setSelectedFile(event.target.files[0]);
    } else {
      setSelectedFile(null);
    }
  };

  const handleAttachmentClick = () => {
    fileInputRef.current?.click();
  };

  const handleClearFile = () => {
    setSelectedFile(null);
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  return (
    <div className="chat-input">
      <div className="chat-input__container">
        <button
          onClick={handleAttachmentClick}
          disabled={loading}
          className="chat-input__attachment-button"
          title="Attach file"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21.44 11.05C21.44 11.05 21.44 11.05 21.44 11.05C20.36 5.24001 15.63 1.00001 9.99999 1.00001C4.63999 1.00001 0.479991 5.01001 0.0699911 10.31C-0.450009 16.95 4.76999 22.41 11.03 22.92C11.04 22.92 11.05 22.92 11.06 22.92C11.33 22.92 11.59 22.86 11.83 22.75C12.56 22.42 13.01 21.64 12.93 20.83C12.84 19.91 12.09 19.24 11.18 19.24C11.11 19.24 11.04 19.24 10.97 19.25C7.24999 18.99 4.50999 15.82 4.50999 12C4.50999 8.23001 7.60999 5.18001 11.39 5.03001C14.95 4.88001 17.91 7.59001 18.06 11.11C18.22 14.79 15.41 17.74 11.86 17.93C11.85 17.93 11.84 17.93 11.83 17.93C11.22 17.93 10.68 18.21 10.38 18.68C10.26 18.88 10.24 19.13 10.35 19.33C10.44 19.52 10.62 19.65 10.83 19.68C10.88 19.69 10.93 19.69 10.98 19.69C11.03 19.69 11.08 19.69 11.13 19.68C15.68 19.29 19.41 15.48 19.41 10.94C19.41 10.94 19.41 10.93 19.41 10.92C19.41 7.05001 16.31 3.98001 12.43 3.98001C8.82999 3.98001 5.95999 6.66001 5.56999 10.14C5.53999 10.41 5.51999 10.69 5.51999 10.97C5.51999 11.25 5.53999 11.52 5.56999 11.79C5.79999 13.75 7.09999 15.22 8.79999 15.7C9.00999 15.77 9.18999 15.96 9.21999 16.18C9.24999 16.39 9.11999 16.6 8.90999 16.67C7.00999 17.22 5.40999 18.56 4.68999 20.37C4.58999 20.62 4.35999 20.79 4.09999 20.79C3.92999 20.79 3.76999 20.74 3.62999 20.64C2.50999 19.84 1.83999 18.53 1.83999 17.06C1.83999 16.83 1.84999 16.6 1.85999 16.37C2.48999 12.04 6.41999 8.48001 11.03 8.05001C11.04 8.05001 11.05 8.05001 11.06 8.05001C15.63 7.76001 19.41 11.32 19.41 15.84C19.41 15.85 19.41 15.86 19.41 15.87C19.41 18.08 18.6 20.1 17.23 21.54C16.76 22.01 16.39 22.31 16.07 22.53C15.47 22.94 14.75 23.17 14 23.17C13.82 23.17 13.64 23.16 13.46 23.13C10.29 22.59 7.79001 20.22 7.43001 17.01C7.39001 16.66 7.12001 16.39 6.77001 16.39C6.40001 16.39 6.08001 16.69 6.08001 17.06C6.08001 17.08 6.08001 17.11 6.08001 17.13C6.52001 20.93 9.70001 23.92 13.62 24.41C13.64 24.41 13.66 24.41 13.68 24.41C17.94 24.41 21.44 21.11 21.44 16.94C21.44 14.08 20 11.57 17.82 10.06C17.47 9.82001 17.28 9.43001 17.35 9.03001C17.43 8.56001 17.84 8.24001 18.31 8.24001C18.44 8.24001 18.58 8.26001 18.7 8.30001C21.44 9.45001 23.19 12.25 23.19 15.38C23.19 18.91 20.6 21.88 17.18 22.69C17.12 22.71 17.06 22.72 17 22.72C16.76 22.72 16.51 22.65 16.3 22.51C14.71 21.53 13.7 19.88 13.7 18C13.7 17.98 13.7 17.97 13.7 17.95C13.7 15.32 15.74 13.28 18.38 13.28C18.61 13.28 18.84 13.3 19.06 13.35L19.58 13.47C20.09 13.6 20.52 14 20.73 14.49C20.81 14.68 20.75 14.91 20.58 15.03C20.42 15.15 20.2 15.14 20.05 15L19.53 14.88C19.33 14.83 19.12 14.81 18.9 14.81C16.92 14.81 15.31 16.42 15.31 18.4C15.31 18.42 15.31 18.43 15.31 18.45C15.31 20.38 16.48 21.93 18.11 22.59C18.26 22.65 18.4 22.76 18.49 22.91C18.54 23.01 18.56 23.12 18.56 23.23C18.56 23.58 18.33 23.89 18 24.03C17.74 24.14 17.46 24.17 17.18 24.17C14.24 24.17 11.79 21.72 11.79 18.79C11.79 18.77 11.79 18.76 11.79 18.74C11.79 16.43 13.26 14.47 15.36 13.66C15.65 13.54 15.85 13.26 15.85 12.95C15.85 12.56 15.55 12.24 15.17 12.18L14.92 12.14C12.48 11.79 10.27 13.06 9.24001 15.03C8.99001 15.45 8.52001 15.7 8.02001 15.7C7.64001 15.7 7.28001 15.56 7.00001 15.3C6.08001 14.55 5.51001 13.38 5.51001 12.11C5.51001 12.09 5.51001 12.08 5.51001 12.06C5.51001 9.04001 7.91001 6.58001 10.97 6.05001C11.01 6.05001 11.04 6.04001 11.08 6.04001C14.32 5.85001 16.92 8.32001 17.06 11.52C17.22 15.25 14.5 18.22 10.89 18.43C10.88 18.43 10.87 18.43 10.86 18.43C9.57001 18.43 8.42001 17.42 8.26001 16.14C8.24001 15.93 8.06001 15.77 7.85001 15.77C7.60001 15.77 7.39001 15.95 7.37001 16.2C7.19001 17.67 8.04001 19.04 9.39001 19.52C9.59001 19.6 9.73001 19.78 9.73001 19.99C9.73001 20.26 9.55001 20.47 9.29001 20.52C7.28001 20.93 5.52001 22.28 4.66001 24.18C4.56001 24.39 4.32001 24.54 4.05001 24.54C3.67001 24.54 3.33001 24.28 3.23001 23.91C1.96001 19.21 5.71001 15.11 10.43 14.25C10.62 14.21 10.8 14.05 10.83 13.84C10.86 13.63 10.73 13.42 10.52 13.35C8.08001 12.52 6.08001 10.24 6.08001 7.52C6.08001 7.5 6.08001 7.49 6.08001 7.47C6.08001 4.06001 8.88001 1.24001 12.3 0.58001C12.56 0.53001 12.82 0.64001 12.96 0.86001C13.1 1.07001 13.07 1.35001 12.89 1.52001C10.21 3.67001 8.81001 6.89001 9.50001 10.03L9.55001 10.23C9.60001 10.42 9.78001 10.55 9.98001 10.55C10.18 10.55 10.37 10.43 10.43 10.24L10.49 10.03C10.94 8.41001 12.14 7.09001 13.67 6.27001C13.88 6.16001 14.13 6.21001 14.27 6.39001C14.41 6.58001 14.38 6.84001 14.2 7.00001C12.92 8.20001 12.06 9.78001 12.06 11.52C12.06 11.53 12.06 11.55 12.06 11.56C12.06 14.38 14.03 16.59 16.63 17.11C16.87 17.16 17.08 17.35 17.08 17.6C17.08 17.88 16.84 18.1 16.57 18.04C13.58 17.43 11.31 14.88 11.31 11.81C11.31 11.79 11.31 11.78 11.31 11.76C11.31 9.31001 12.92 7.20001 15.17 6.30001C15.41 6.20001 15.54 5.95001 15.46 5.71001C15.38 5.47001 15.13 5.34001 14.89 5.42001C12.21 6.48001 10.06 8.96001 10.06 11.96C10.06 11.97 10.06 11.99 10.06 12C10.06 15.43 12.52 18.21 15.74 18.79C15.95 18.82 16.15 18.99 16.18 19.2C16.21 19.42 16.07 19.63 15.86 19.7C13.31 20.58 11.25 22.78 11.18 25.44C11.17 25.84 11.46 26.17 11.86 26.17C12.26 26.17 12.57 25.87 12.59 25.46C12.7 23.44 14.09 21.76 15.97 20.94C16.16 20.85 16.37 20.91 16.5 21.06C16.63 21.22 16.64 21.44 16.53 21.6C15.01 23.29 13.75 25.42 13.75 27.75C13.75 27.97 13.93 28.15 14.15 28.15H18.85C19.07 28.15 19.25 27.97 19.25 27.75C19.25 25.45 18.01 23.34 16.53 21.69C16.41 21.52 16.43 21.3 16.56 21.15C16.7 21 16.92 20.99 17.06 21.12C18.77 22.55 20 24.75 20 27.15C20 27.37 20.18 27.55 20.4 27.55H21.6C21.82 27.55 22 27.37 22 27.15C22 24.75 20.77 22.55 19.06 21.12C18.92 20.99 18.7 21 18.56 21.15C18.43 21.3 18.41 21.52 18.53 21.69C19.99 23.34 21.25 25.45 21.25 27.75C21.25 27.97 21.43 28.15 21.65 28.15H22.35C22.57 28.15 22.75 27.97 22.75 27.75C22.75 24.75 20.25 22.25 17.25 22.25C14.25 22.25 11.75 24.75 11.75 27.75C11.75 27.97 11.93 28.15 12.15 28.15H13.85C14.07 28.15 14.25 27.97 14.25 27.75C14.25 25.93 15.24 24.32 16.78 23.33C16.96 23.22 17.01 22.99 16.88 22.82C16.75 22.65 16.51 22.59 16.32 22.69C14.51 23.83 13.25 25.69 13.25 27.75C13.25 27.97 13.07 28.15 12.85 28.15H11.15C10.93 28.15 10.75 27.97 10.75 27.75C10.75 25.69 9.49001 23.83 7.68001 22.69C7.49001 22.59 7.25001 22.65 7.12001 22.82C6.99001 22.99 7.04001 23.22 7.22001 23.33C8.76001 24.32 9.75001 25.93 9.75001 27.75C9.75001 27.97 9.57001 28.15 9.35001 28.15H5.65001C5.43001 28.15 5.25001 27.97 5.25001 27.75C5.25001 25.69 3.99001 23.83 2.18001 22.69C1.99001 22.59 1.75001 22.65 1.62001 22.82C1.49001 22.99 1.54001 23.22 1.72001 23.33C3.24001 24.32 4.25001 25.93 4.25001 27.75C4.25001 27.97 4.07001 28.15 3.85001 28.15H2.15C1.93001 28.15 1.75001 27.97 1.75001 27.75C1.75001 25.42 0.280009 23.29 0.0400089 21.6C-0.0900089 20.95 -0.0400089 20.27 0.200009 19.66L21.44 11.05Z" fill="currentColor"/>
          </svg>
        </button>
        <input
          type="file"
          ref={fileInputRef}
          onChange={handleFileChange}
          style={{ display: 'none' }}
          className="chat-input__file-input"
        />
        <textarea
          value={input}
          onChange={(e) => onInputChange(e.target.value)}
          onKeyDown={handleKeyPress}
          placeholder={selectedFile ? "Message (file selected)" : "Type your message here..."}
          disabled={loading}
          className="chat-input__textarea"
          rows={1}
        />
        <button
          onClick={handleSendClick}
          disabled={(!input.trim() && !selectedFile) || loading}
          className="chat-input__button"
          title="Send message"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
        </button>
      </div>
      {selectedFile && (
        <div className="chat-input__selected-file">
          <span>{selectedFile.name}</span>
          <button onClick={handleClearFile} title="Clear file">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
          </button>
        </div>
      )}
    </div>
  );
}; 